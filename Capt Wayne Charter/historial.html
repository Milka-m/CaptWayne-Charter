<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Historial de Actividad</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;600;800&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Outfit', sans-serif;
      background-image: url('https://media.istockphoto.com/id/184600243/photo/coral-reef-roatan-honduras.jpg?s=612x612&w=0&k=20&c=-tvn8IxjLPQnW-NWD2cqKaR7ZXRY0X2OFh2cIvfiqh4=');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      background-repeat: no-repeat;
      color: #1f2937;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 3rem 1rem 6rem;
    }
    .bg-blur {
      background: rgba(255, 255, 255, 0.4);
      backdrop-filter: blur(6px);
      border-radius: 1rem;
      padding: 2rem;
      max-width: 600px;
      width: 100%;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .scrollable-history {
      max-height: 360px;
      overflow-y: auto;
      margin-top: 1rem;
    }
    .history-item {
      background: white;
      border-radius: 0.5rem;
      padding: 1rem 1.5rem;
      box-shadow: 0 1px 6px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }
    footer {
      background-color: #0d9488;
      color: white;
      text-align: center;
      padding: 1.5rem 0;
      width: 100%;
      border-radius: 0 0 1rem 1rem;
      position: fixed;
      bottom: 0;
      left: 0;
    }
    a.back-link {
      display: inline-block;
      margin: 1.5rem 0 0;
      color: #0d9488;
      text-decoration: underline;
      font-weight: 600;
    }
  </style>
</head>
<body data-page="Inicio">

  <section class="bg-blur">
    <h1 class="text-4xl font-extrabold text-teal-800 text-center">Historial de Actividad</h1>

    <div class="scrollable-history" aria-label="Lista de actividades recientes"></div>

    <div class="flex justify-between mt-6">
      <button id="export-btn" class="bg-teal-600 hover:bg-teal-500 text-white font-semibold px-4 py-2 rounded transition">Exportar Historial</button>
      <button id="clear-btn" class="bg-red-600 hover:bg-red-500 text-white font-semibold px-4 py-2 rounded transition">Limpiar Historial</button>
    </div>

    <a href="perfil.html" class="back-link">← Volver a Mi Perfil</a>
  </section>

  <footer>
    <p class="text-sm">&copy; 2025 Capt. Wayne Charters. Todos los derechos reservados.</p>
  </footer>

  <script>
    // ====== Variables ======
    const historyContainer = document.querySelector('.scrollable-history');
    const clearBtn = document.getElementById('clear-btn');
    const exportBtn = document.getElementById('export-btn');
    const pageName = document.body.dataset.page || 'Página';

    // ====== Funciones ======
    function getCurrentDateTime() {
      const now = new Date();
      const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute:'2-digit', second:'2-digit' };
      return now.toLocaleDateString('es-ES', options);
    }

    function saveAction(action, status='✔️') {
      const history = JSON.parse(localStorage.getItem('activityHistory')) || [];
      const entry = {
        page: pageName,
        action,
        datetime: getCurrentDateTime(),
        status
      };
      history.push(entry);
      localStorage.setItem('activityHistory', JSON.stringify(history));
      renderHistory();
    }

    function renderHistory() {
      const history = JSON.parse(localStorage.getItem('activityHistory')) || [];
      historyContainer.innerHTML = '';
      if(history.length === 0){
        historyContainer.innerHTML = '<p class="text-center text-gray-700">No hay actividades recientes.</p>';
        return;
      }
      history.forEach(h => {
        const div = document.createElement('div');
        div.classList.add('history-item');
        div.innerHTML = `
          <div>
            <p class="font-semibold">${h.action} - ${h.page}</p>
            <p class="text-gray-700 text-sm">${h.datetime}</p>
          </div>
          <span class="text-teal-700 font-bold text-xl">${h.status}</span>
        `;
        historyContainer.appendChild(div);
      });
    }

    function clearHistory() {
      if(confirm('¿Estás seguro que quieres limpiar el historial de actividad?')){
        localStorage.removeItem('activityHistory');
        renderHistory();
      }
    }

    function exportHistory() {
      const history = JSON.parse(localStorage.getItem('activityHistory')) || [];
      const blob = new Blob([JSON.stringify(history, null, 2)], {type: "application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'historial_actividad.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    // ====== Eventos ======
    clearBtn.addEventListener('click', clearHistory);
    exportBtn.addEventListener('click', exportHistory);

    // Registrar carga de página automáticamente
    window.addEventListener('load', () => {
      saveAction('Ingreso a la página');
    });

    // Ejemplo: registrar cualquier click en botones, links o inputs
    document.addEventListener('click', e => {
      if(e.target.tagName === 'BUTTON' || e.target.tagName === 'A'){
        const actionText = e.target.innerText || e.target.title || 'Clic';
        saveAction(`Clic en "${actionText}"`);
      }
    });

    // Ejemplo: registrar cambios en inputs o selects
    document.addEventListener('change', e => {
      if(e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT' || e.target.tagName === 'TEXTAREA'){
        const name = e.target.id || e.target.name || 'Campo';
        saveAction(`Cambio en "${name}"`);
      }
    });

    // Inicializar historial en pantalla
    renderHistory();
  </script>
</body>
</html>
